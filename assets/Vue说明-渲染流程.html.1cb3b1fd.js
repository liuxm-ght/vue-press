import{_ as e,o as t,c as n,g as r}from"./app.7b383bae.js";const o={},d=r(`<h4 id="vue-\u4E00\u822C\u54CD\u5E94\u5F0F\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#vue-\u4E00\u822C\u54CD\u5E94\u5F0F\u6D41\u7A0B" aria-hidden="true">#</a> Vue \u4E00\u822C\u54CD\u5E94\u5F0F\u6D41\u7A0B\uFF1A</h4><p>\u5728\u6B64\u4E4B\u524D\u5BF9Vue\u6784\u9020\u51FD\u6570\u53CA\u539F\u578B\u5BF9\u8C61\u8FDB\u884C\u4E86\u4E00\u7CFB\u5217\u7684\u521D\u59CB\u5316\uFF0C\u4F7F\u5F97Vue\u5B9E\u4F8B\u6709\u4E00\u7CFB\u5217\u7684\u5C5E\u6027\u548C\u65B9\u6CD5</p><ol><li>new Vue(options) -&gt; //src/core/instance/index.js</li><li>_init(options) Vue\u5B9E\u4F8B\u521D\u59CB\u5316</li><li>vm.$options = mergeOptions(...,options\uFF09\u4F20\u5165\u914D\u7F6E\u5408\u5E76</li><li>\u521D\u59CB\u5316</li><li>initProxy(vm) \u4EE3\u7406vm -&gt; //src/core/instance/proxy.js 1. vm._renderProxy = new Proxy(vm, handlers) //\u5BF9Vue\u6216\u7EC4\u4EF6\u5B9E\u4F8B\u4EE3\u7406\u76D1\u542C\uFF0C\u5F53\u8BFB\u53D6\u6216\u904D\u5386\u5B9E\u4F8B\u7684\u5C5E\u6027\u6216\u65B9\u6CD5\u65F6\uFF0C\u505A\u5224\u65AD\u6216\u53D1\u51FA\u8B66\u544A 2. vm._renderProxy // \u5B9E\u4F8B options\u4E0A\u7684 render\u51FD\u6570\u6267\u884C\u65F6\u6240\u5728\u4F5C\u7528\u57DF</li><li>initLifecycle(vm) \u521D\u59CB\u5316\u751F\u547D\u5468\u671F -&gt; //src/core/instance/lifecycle.js 1. \u4E3B\u8981\u662F\u8D4B\u503C\u4E86vm.$parent = parent 2. \u5B9A\u4E49\u4E86\u4E00\u4E9B\u6839\u5C5E\u6027 vm.$root vm.$refs vm._watcher vm._directInactive vm._isMounted vm._isDestroyed...</li><li>initEvents(vm) \u521D\u59CB\u5316\u4E8B\u4EF6 -&gt; ///src/cor= e/instance/events.js 1. vm._events \u7528\u6765\u5B58\u653E\u5F53\u524Dvm\u5B9E\u4F8B\u7684\u6240\u6709\u81EA\u5B9A\u4E49\u4E8B\u4EF6 2. listeners = vm.$options._parentListeners \u4ECEvm\u5B9E\u4F8Boptioins\u53C2\u6570\u4E2D\u83B7\u53D6\u5230\u5F53\u524D\u7EC4\u4EF6\u7ED1\u5B9A\u7684events 3. updateComponentListeners(vm, listeners) \u5C06\u4E8B\u4EF6\u52A0\u5165\u5230\u4E2D</li><li>initRender(vm) \u521D\u59CB\u5316render -&gt; //src/core/instance/render.js 1. $slots \u521D\u59CB\u5316 2. vm\u5B9E\u4F8B\u4E0A\u6302\u8F7D\u65B9\u6CD5 \u6838\u5FC3\u51FD\u6570 _createElement ($createElement = _c = createElement = _createElement) 3. \u52AB\u6301 $attrs $listeners \u4E3A\u540E\u9762\u66F4\u65B0\u51C6\u5907</li><li>callHook(vm, &#39;beforeCreate&#39;) \u89E6\u53D1 beforeCreate \u751F\u547D\u5468\u671F</li><li>initInjections(vm) \u521D\u59CB\u5316 inject</li><li>initState(vm) \u6570\u636E\u52AB\u6301\u521D\u59CB\u5316 -&gt; //src/core/instance/state.js 1. initData(vm) data\\computed\\watch \u6570\u636E\u52AB\u6301\u521D\u59CB\u5316 <ol><li>proxy(vm, <code>_data</code>, key) // \u4EE3\u7406\uFF0C\u76F4\u63A5this.xxx \u4EE3\u66FF this._data.xxx</li><li>observe(data, true /* asRootData */) //\u5F00\u59CB\u6570\u636E\u52AB\u6301,\u4EC5\u52AB\u6301\u5E76\u4E0D\u89E6\u53D1get\u6216set</li><li>new Observer() -&gt; //src/core/observer/index.js \u521B\u5EFA dep = new Dep() \u8BA2\u9605\u5668\u76D2\u5B50\uFF0C\u7528\u6765\u5B58\u653Ewatcher\u4EEC -&gt; //src/core/observer/dep.js walk() \u904D\u5386data defineReactive(obj, keys[i]) \u5C5E\u6027\u8FDB\u884C\u76D1\u542C get: if (Dep.target) dep.depend() \u8BFB\u53D6\u8BE5\u5C5E\u6027\u503C\u65F6\uFF0C\u5C06\u5BF9\u5E94\u7684watcher\u6DFB\u52A0\u5165\u5F53\u524D\u5C5E\u6027\u7684dep\u4E2D; set: dep.notify() \u4FEE\u6539\u8BE5\u5C5E\u6027\u65F6\uFF0Csubs[i].update()\u901A\u77E5\u5BF9\u5E94\u7684(subs[i] -&gt; wathcer)\u66F4\u65B0\u89C6\u56FE ---------watcher \u5728\u4EC0\u4E48\u60C5\u51B5\u4EA7\u751F\uFF1F\u540E\u9762\u4F1A\u8BB2\u5230\u3002 wathcer\u66F4\u65B0\u89C6\u56FE update() -&gt; //src/core/observer/watcher.js queueWatcher(this) \u5C06\u5F53\u524Dwatcher\u52A0\u5165\u5F02\u6B65\u961F\u5217\uFF0C\u662F\u4E3A\u4E86\u9632\u6B62\u6570\u636E\u8FDE\u7EED\u4FEE\u6539\u5BFC\u81F4\u8FDE\u7EED\u7684render\u3001patch\u3001\u64CD\u4F5Cdom\u7B49\u6027\u80FD\u95EE\u9898\uFF0C\u52A0\u5165\u5F02\u6B65\u961F\u5217\uFF0C\u5728nextclick\u540E\u518D\u4FEE\u6539\u5C31\u4E0D\u4F1A\u6709\u8FD9\u95EE\u9898\uFF0Cnextclick\u540E\u62FF\u5230\u7684\u6570\u636E\u662F\u6700\u540E\u4E00\u6B21\u4FEE\u6539\u7684\u6570\u636E -&gt; //src/core/observer/scheduler.js ---------nextclick \u5982\u4F55\u5B9E\u73B0\uFF1F\u4E0B\u4E00\u4E2A\u8BFE\u7A0B\u4F1A\u8BB2\u89E3 nextclick\u540E \u6267\u884C\u56DE\u8C03 flushSchedulerQueue() \u6267\u884Cwatcher.run() //\u6267\u884C\u66F4\u65B0 run () this.get() pushTarget(this) \u5C06Dep.target = this -&gt; this.getter.call(vm, vm) this.getter = expOrFn \u4E3Anew Watcher \u65F6\u7684\u4E00\u4E2A\u53C2\u6570\uFF0Cnew Vue()\u65F6\u662FupdateComponent -&gt; //src/core/instance/lifecycle.js , updateComponent vm._update(vm._render(), hydrating) vm._render() \u5C06new Vue()\u7684render\u51FD\u6570\u8F6C\u6362\u4E3Avnode vm._update \u5C06\u8F6C\u6362\u7684vnode\u751F\u6210\u771F\u5B9Edom\uFF0C\u5373\u6302\u8F7D</li></ol></li><li>initProvide(vm) \u521D\u59CB\u5316 provide</li><li>callHook(vm, &#39;created&#39;) \u89E6\u53D1 beforeCreate \u751F\u547D\u5468\u671F</li><li>vm.$mount(vm.$options.el) \u5F00\u59CBdom\u6302\u8F7D</li><li>\u5F00\u59CB\u6302\u8F7D\u4E3B\u8981\u505A\u4E86\u5982\u4E0B\u4E8B\u60C5\uFF1A</li><li>\u521D\u6B21\u6E32\u67D3\u65F6\uFF0C\u751F\u6210\u6E32\u67D3watcher\uFF08 pushTarget(this) //Dep.target = this\uFF09\uFF0C</li><li>\u89E6\u53D1render\u51FD\u6570\u751F\u6210vnode\uFF08\u6267\u884Crender\u8BFB\u53D6\u5BF9\u5E94\u6570\u636E\u65F6\uFF0C\u4F1A\u89E6\u53D1\u5BF9\u5E94\u7684get\uFF0C\u5C06\u8FD9\u4E2Awatcher\u6DFB\u52A0\u5230\u5F53\u524D\u8BA2\u9605\u5668\u4E2D\u53BB\uFF09\uFF0C</li><li>\u6267\u884C_update\u5C06vnode\u8F6C\u5316\u6210\u771F\u5B9Edom\uFF0C\u63D2\u5165\u5230html\u6587\u6863\u4E2D\u53BB\uFF0C\u6302\u8F7D\u5B8C\u6210 ---------watcher \u5982\u4F55\u6267\u884C\uFF1F\u4E0B\u4E00\u4E2A\u8BFE\u7A0B\u4F1A\u8BB2\u89E3</li><li>\u6570\u636E\u66F4\u65B0\u65F6\uFF0C\u89E6\u53D1\u5BF9\u5E94watcher\u7684update\uFF0C\u540C\u6837\u89E6\u53D1render\u51FD\u6570\u751F\u6210\u65B0\u7684vnode\uFF0C\u6267\u884C_update\u5C06\u65B0\u65E7vnode diff\u6BD4\u5BF9\uFF0C\u64CD\u4F5C\u65E7dom\u771F\u5B9E\u66F4\u65B0dom</li></ol><h5 id="watcher-\u5982\u4F55\u6267\u884C" tabindex="-1"><a class="header-anchor" href="#watcher-\u5982\u4F55\u6267\u884C" aria-hidden="true">#</a> watcher \u5982\u4F55\u6267\u884C\uFF1F</h5><ol><li>vm.$mount \u6267\u884C\u7684\u662F mountComponent -&gt; //src/core/instance/lifecycle.js</li><li>callHook(vm, &#39;beforeMount&#39;)</li><li>new Watcher(vm, updateComponent,...) 1. \u5B9E\u4F8B\u5316Watcher\uFF0C\u6267\u884Cthis.get()\uFF0CpushTarget(this)(Dep.target = this)\uFF0C 2. value = this.getter.call(vm, vm) //\u9996\u6B21\u6302\u8F7D\u65F6\uFF0C\u6267\u884C\u7684\u662FupdateComponent -&gt; //src/core/instance/lifecycle.js\uFF09 3. vm._render() \u6267\u884Cvm\u7684\u6E32\u67D3\u51FD\u6570\uFF0C\u6700\u540E\u4F1A\u751F\u6210vnode\u8FD4\u56DE <ol><li>\u5982\u679C\u8FC7\u7A0B\u4E2D\u9047\u5230\u7EC4\u4EF6\uFF0C\u4F1A\u751F\u6210\u7EC4\u4EF6vnode\uFF0C\u5E26\u6709Ctor\uFF0C\u65E0children\u3001parent,elm\u6307\u5411undefined</li><li>\u5982\u679C\u662F\u666E\u901A\u8282\u70B9\uFF0C\u4F1A\u751F\u6210\u975E\u7EC4\u4EF6vnode\uFF0C\u6709children\u3001parent,elm\u6307\u5411\u5F53\u524Delm</li></ol></li></ol><pre><code>4. vm._update() \u6839\u636E\u8FD4\u56DE\u7684vnode\uFF0C\u8FDB\u884Cpatch\u3001diff\u6BD4\u5BF9\u8FC7\u7A0B\uFF0C\u751F\u6210\u771F\u5B9Edom
  1. \u6839\u636Evnode\u521B\u5EFA\u771F\u5B9Edom
  2. \u5982\u679C\u662F\u7EC4\u4EF6vnode\uFF0C\u5B9E\u4F8B\u5316\u7EC4\u4EF6vnode.Ctor,\u8FDB\u5165\u7EC4\u4EF6\u7684\u521D\u59CB\u5316\u3001render\u3001update\u3001patch\u3001diff\u3001\u751F\u6210dom\u3001\u6302\u8F7D\u5230\u7236\u7EA7el
  3. \u5982\u679C\u662F\u975E\u7EC4\u4EF6v\u5F04\u7684\uFF0C\u76F4\u63A5\u751F\u6210\u521B\u5EFAdom\uFF0C\u9012\u5F52\u5904\u7406\u5B50\u7EC4\u4EF6\uFF0C\u63D2\u5165\u5230\u5F53\u524Ddom\u4E2D\u53BB\uFF0C\u6700\u540E\u5C06\u5F53\u524Ddom\u6302\u8F7D\u5230\u7236\u7EA7el
5. \u6700\u540E\u5C06vm.$el = el \u6302\u8F7D\u5230body\u4E0A\u53BB
</code></pre><ol start="4"><li>vm._isMounted = true</li><li>callHook(vm, &#39;mounted&#39;)</li></ol><h4 id="vue\u7EC4\u4EF6\u7684\u9996\u6B21\u6E32\u67D3\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#vue\u7EC4\u4EF6\u7684\u9996\u6B21\u6E32\u67D3\u6D41\u7A0B" aria-hidden="true">#</a> Vue\u7EC4\u4EF6\u7684\u9996\u6B21\u6E32\u67D3\u6D41\u7A0B\uFF1F</h4><p>\u5728\u6B64\u4E4B\u524D\u5BF9Vue\u6784\u9020\u51FD\u6570\u53CA\u539F\u578B\u5BF9\u8C61\u8FDB\u884C\u4E86\u4E00\u7CFB\u5217\u7684\u521D\u59CB\u5316\uFF0C\u4F7F\u5F97Vue\u5B9E\u4F8B\u6709\u4E00\u7CFB\u5217\u7684\u5C5E\u6027\u548C\u65B9\u6CD5 \u5E76\u4E14\u7ECF\u8FC7\u4E86\u4E0A\u97621234\u4E00\u7CFB\u5217\u521D\u59CB\u5316\u3001\u6570\u636E\u52AB\u6301\u3001\u5F00\u59CB\u6302\u8F7D5 \u6302\u8F7D\u8FC7\u7A0B\u8DDF6\u4E00\u6837\uFF0C\u53EA\u662F\u5728\u6267\u884Crender\u51FD\u6570\u65F6\uFF0C\u4F1A\u5728_createElement\u5224\u65AD\u662F\u5426\u4E3A\u7EC4\u4EF6\uFF0C\u662F\u7EC4\u4EF6\u8D70\u521B\u5EFA\u7EC4\u4EF6\u6D41\u7A0B</p><ol><li>createComponent \u4F1A\u6839\u636ECtor(VueComponent\u7EC4\u4EF6\u6784\u9020\u5668)\u521B\u5EFA\u4E00\u4E2A\u865A\u62DFVnode</li><li>\u8FD4\u56DEVnode\u8FDB\u884C\uFF0C \u6267\u884Cvm._update(vm._render(), hydrating)\uFF0C --------- patch vnode\u5230\u771F\u5B9Edom\uFF1F\u4E0B\u4E00\u4E2A\u8BFE\u7A0B\u4F1A\u8BB2\u89E3 \u4F1A\u8FDB\u884Cpatch\u6BD4\u5BF9\uFF0C\u6709\u4E24\u79CD\u60C5\u51B5\uFF1A 1. \u65E7\u8282\u70B9\u975E\u7EC4\u4EF6\uFF1A 1. \u65E7\u8282\u70B9\u4E3A\u771F\u5B9EoldDom\uFF0C\u8F6C\u4E3A\u7A7Avnode\uFF0CcreateElm\u5C06\u65B0vnode\u8F6C\u4E3A\u771F\u5B9EnewDom\u6302\u8F7D\u5230oldDom\u7684\u7236\u7EA7dom\u53BB\uFF0C\u6E05\u9664\u6389oldDom 2. \u65E7\u8282\u70B9\u4E3A\u771F\u5B9EoldVnode\uFF0C\u4E14\u65B0\u65E7\u90FD\u4E3A\u540C\u4E00\u8282\u70B9\uFF0CpatchVnode\u6BD4\u5BF9\u8282\u70B9\uFF0C\u66F4\u65B0dom 2. \u65E7\u8282\u70B9\u7EC4\u4EF6 1. \u521D\u6B21patch\u8FC7\u7A0B\u65F6\uFF0C\u65E0\u65E7\u771F\u5B9E\u6216\u865A\u62DF\u8282\u70B9\uFF0C\u5373isUndef(oldVnode)\u662Ftrue\u7684 \u76F4\u63A5createElm(vnode, insertedVnodeQueue) \u521B\u5EFA\u771F\u5B9Edom \u5224\u65AD\u662F\u5426\u4E3A\u7EC4\u4EF6createComponent(vnode, insertedVnodeQueue, parentElm, refElm) let i = vnode.data;if (isDef(i)) \u5224\u65AD\u662F\u5426\u4E3A\u7EC4\u4EF6 1. if (isDef(i = i.hook) &amp;&amp; isDef(i = i.init)) \u662F\u7EC4\u4EF6\u4E14\u6709init\u51FD\u6570\uFF0C \u6267\u884Cinit\uFF0C\u5F00\u59CB\u7EC4\u4EF6\u7684\u5B9E\u4F8B\u5316 const child = vnode.componentInstance = createComponentInstanceForVnode(vnode,activeInstance) \u5B9E\u4F8B\u5316\u7EC4\u4EF6 return new vnode.componentOptions.Ctor(options) // \u8FD4\u56DE \u7EC4\u4EF6 Sub\u5B9E\u4F8B \u5B9E\u4F8B\u5316\u7EC4\u4EF6\u8FC7\u7A0B\u4E2D\u8FDB\u884C\u4E86\uFF0C\u7EC4\u4EF6\u7684\u521D\u59CB\u5316\uFF0C\u521D\u59CB\u5316\u5B8C\u6210\uFF0C\u4F46\u662F\u6CA1\u6709el\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u6302\u8F7D\uFF0C\u6700\u540E\u8FD4\u56DE\u7EC4\u4EF6\u5B9E\u4F8B child.$mount(hydrating ? vnode.elm : undefined, hydrating) \u5C06\u8FD4\u56DE\u7684Sub\u6302\u8F7D\uFF0C\u4F46vnode.elm\u5373\u7236\u7EA7\u4E3Aundefined\uFF0C\u6240\u4EE5\u6682\u4E0D\u6302\u8F7D 2. if (isDef(vnode.componentInstance)) \u5982\u679C\u662F\u6709\u7EC4\u4EF6\u662F\u88AB\u5B9E\u4F8B\u5316\u4E86\u7684\uFF0C\u90A3\u4E48\u5F00\u59CB\u7EC4\u4EF6\u6302\u8F7D initComponent(vnode, insertedVnodeQueue) insert(parentElm, vnode.elm, refElm) \u5C06\u521B\u5EFA\u597D\u7684\u7EC4\u4EF6\u5BF9\u5E94\u7684\u771F\u5B9Edom\u63D2\u5165\u5230\u7236\u7EA7\u4E2D\u53BB</li></ol><h5 id="\u6CE8\u610F\u4E24\u4E2A\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u610F\u4E24\u4E2A\u6982\u5FF5" aria-hidden="true">#</a> \u6CE8\u610F\u4E24\u4E2A\u6982\u5FF5</h5><ol><li>\u7EC4\u4EF6vnode\uFF0C\u7EC4\u4EF6vnode\u662F\u7528h(App)\u3001link.js\u8FD9\u6837render\u8FD4\u56DE\u7684vnode\uFF0C\u6CA1\u6709children vnodes \u548C parent vnode\uFF0C\u643A\u5E26\u6709ctor\u6784\u9020\u51FD\u6570</li><li>\u975E\u7EC4\u4EF6vnode\uFF0C\u975E\u7EC4\u4EF6vnode\u662F\u5B9E\u4F8B\u5316\u7EC4\u4EF6\u65F6render\u8FD4\u56DE\u7684vnode\uFF0C\u4E00\u822C\u6709children vnodes \u548C parent vnode\uFF08\u5373\u5B9E\u4F8B\u5316\u7EC4\u4EF6vnode\uFF09</li></ol><h5 id="_1-\u6848\u4F8B\u4E00-\u9879\u76EE\u76EE\u5F55\u7ED3\u6784-\u9879\u76EE\u5B58\u5728-vue-router-test-router-test-users-xiaoming-liu-test-projects-vue-vue-router-vue-router-test-vue-router-3-5-3-test" tabindex="-1"><a class="header-anchor" href="#_1-\u6848\u4F8B\u4E00-\u9879\u76EE\u76EE\u5F55\u7ED3\u6784-\u9879\u76EE\u5B58\u5728-vue-router-test-router-test-users-xiaoming-liu-test-projects-vue-vue-router-vue-router-test-vue-router-3-5-3-test" aria-hidden="true">#</a> 1.\u6848\u4F8B\u4E00\uFF1A\u9879\u76EE\u76EE\u5F55\u7ED3\u6784\uFF0C\u9879\u76EE\u5B58\u5728 vue-router-test/router-test \uFF08/Users/xiaoming.liu/test-projects/vue/vue-router/vue-router-test/vue-router-3.5.3-test\uFF09</h5><p>----main.js App.vue ----component ----hello.vue home.vue helle-child1.vue helle-child2.vue . . . \u6267\u884Cmain.js 1. new Vue({ render: h =&gt; h(App)}).$mount(&#39;#app&#39;) , App\u4E3AApp.vue\u6587\u4EF6\u89E3\u6790\u540E\u7684\u7EC4\u4EF6\u5BF9\u8C61\uFF0C \u7ED3\u6784\u5927\u6982\u5982\uFF1A {name:&#39;App&#39;,render:f(),data:f(),beforeCreate:f()...} \u6CE8\u91CA\uFF1Arender\u51FD\u6570\u662FApp.vue\u6587\u4EF6\u89E3\u6790\u540E\u7684render\u51FD\u6570(render_App)\uFF0C\u8FD4\u56DE\u4E00\u4E2A_createElemnet\u51FD\u6570\uFF0C \u7ED3\u6784\u5927\u6982\u5982\uFF1A return _c( &quot;div&quot;, { attrs: { id: &quot;app&quot; } }, [ _c(&quot;router-link&quot;, { attrs: { to: &quot;/home&quot; } }, [_vm._v(&quot;home\u7684link&quot;)]), _c(&quot;span&quot;, { staticStyle: { margin: &quot;0 10px&quot; } }, [_vm._v(&quot;|&quot;)]), _c(&quot;router-link&quot;, { attrs: { to: &quot;/hello&quot; } }, [_vm._v(&quot;hello\u7684link&quot;)]), _c(&quot;router-view&quot;), ], 1 ) 2. \u5B9E\u4F8B\u5316Vue\uFF0C\u5F00\u59CB\u6E32\u67D3\u7EC4\u4EF6 1. new Watcher () (\u540E\u9762\u7528Watcher_Vue_Big\u6765\u4EE3\u66FFnew Watcher)\uFF0Cget\uFF0C \u6267\u884Crender\uFF0C\u6267\u884Ch =&gt; h(App),_createElement,createComponent, return vnode_App \u643A\u5E26Ctor_App\u7684vnode\uFF0C\u7EC4\u4EF6vnode \u6267\u884Cpatch_BigVue\uFF0CcreateElm(vnode_App,parentElm_body),createComponent(parentElm_body),i.hook.init\u89E6\u53D1Ctor_App\u7EC4\u4EF6\u5B9E\u4F8B\u5316 (\u6CE8\u91CA: \u7531\u4E8E\u4E00\u5F00\u59CBdiv#app\u4E3A\u771F\u5B9Edom\uFF0C\u6240\u4EE5\u8D70\u6D41\u7A0BcreateElm\u65F6\u4F1A\u62FF\u5230body\u4E3AparentElm\uFF0C\u8FD9\u662F\u7B2C\u4E00\u4E2A\u5E26parentElm\u7684createElm) 2. new VueComponent_App()(\u540E\u9762\u7528Watcher_Vue_App),get, \u6267\u884Crender_App\uFF0C\u6309\u7A0B\u5E8F\u987A\u5E8F\u6700\u5F00\u59CB \u6267\u884C_c(&quot;router-link&quot;...),_createElement,createComponent,return vnode_RouterLink \u643A\u5E26Ctor_RouterLink\u7684vnode\uFF0C\u7EC4\u4EF6vnode (\u6CE8\u91CA\uFF1A\u6B64\u65F6createComponent\u8FD4\u56DE\u7684vnode\u662F\u6CA1\u6709children\u7684\uFF0C\u6240\u4EE5\u540E\u9762diff\u4F1A\u76F4\u63A5\u8DF3\u8FC7\u4E0D\u4F1A\u6DF1\u5165diff) \u6267\u884C_c(&quot;span&quot;...),_createElement,return vnode_span\uFF0C\u975E\u7EC4\u4EF6vnode (\u6CE8\u91CA\uFF1A\u6B64\u65F6createComponent\u8FD4\u56DE\u7684vnode\u662F\u6709children\u7684\uFF0C\u6240\u4EE5\u540E\u9762\u4F1A\u6DF1\u5165diff) \u6267\u884C_c(&quot;router-link&quot;...),<em>createElement,createComponent,return vnode_RouterLink \u643A\u5E26Ctor_RouterLink\u7684vnode\uFF0C\u7EC4\u4EF6vnode (\u6CE8\u91CA\uFF1A\u6B64\u65F6createComponent\u8FD4\u56DE\u7684vnode\u662F\u6CA1\u6709children\u7684\uFF0C\u6240\u4EE5\u540E\u9762diff\u4F1A\u76F4\u63A5\u8DF3\u8FC7\u4E0D\u4F1A\u6DF1\u5165diff) \u6267\u884C_c(&quot;router-view&quot;...),<em>createElement,createComponent,Ctor.options.functional=true\uFF0CcreateFunctionalComponent\uFF0C\u6267\u884Crouter-view\u7684render\u51FD\u6570\uFF0C\u7531\u4E8E\u9ED8\u8BA4\u8DEF\u7531\u4E3A/\uFF0C\u6CA1\u6709\u5BF9\u5E94\u7684\u7EC4\u4EF6\uFF0C\u6240\u4EE5record\u4E3Anull\uFF0Creturn h()\uFF0CcreateEmptyVNode\uFF0Creturn empty_vnode\uFF0C\u975E\u7EC4\u4EF6vnode ( \u6CE8\u91CA\uFF1Arouter-view\u7EC4\u4EF6\u5728VueRouter\u5B9E\u4F8B\u521D\u59CB\u5316init\u65F6\u6CE8\u518C\u4E86\uFF0Crouter-view\u7EC4\u4EF6\u7ED3\u6784\u5927\u6982\u5982\uFF1A routerView = { functional: true, render(h, { parent, data }) { console.log(&#39;view render &#39;,{ parent, data }); const { matched } = parent.$route data.routerView = true // \u6807\u8BC6\u6B64\u7EC4\u4EF6\u4E3Arouter-view let depth = 0 // \u6DF1\u5EA6\u7D22\u5F15 while(parent) { // \u5982\u679C\u6709\u7236\u7EC4\u4EF6\u4E14\u7236\u7EC4\u4EF6\u4E3Arouter-view \u8BF4\u660E\u7D22\u5F15\u9700\u8981\u52A01 if (parent.$vnode &amp;&amp; parent.$vnode.data.routerView) { depth++ } parent = parent.$parent } const record = matched[depth] if (!record) { return h() } const component = record.component // \u4F7F\u7528render\u7684h\u51FD\u6570\u8FDB\u884C\u6E32\u67D3\u7EC4\u4EF6 return h(component, data) } } ) \u6267\u884C_c(&quot;div&quot;...,children:[vnode_RouterLink,vnode_span\uFF0C,vnode_RouterLink,empty_vnode]),<em>createElement,return vnode_div\uFF0C\u975E\u7EC4\u4EF6vnode (\u6CE8\u91CA\uFF1A\u6B64\u65F6\u8FD4\u56DE\u7684vnode\u662F\u6709children\u7684\uFF0C\u6240\u4EE5\u540E\u9762diff\u4F1A\u6DF1\u5165diff) \u6267\u884Cpatch_App\uFF0CcreateElm(vnode_div,parentElm_undefined \uFF09,createComponent(\u5224\u65AD\u4E3A\u975E\u7EC4\u4EF6),createChildren,children:[vnode_RouterLink,vnode_span\uFF0C,vnode_RouterLink,empty_vnode],\u5F00\u59CB\u5FAA\u73AF\u5904\u7406\u5B50\u7EC4\u4EF6dom\u63D2\u5165 (\u6CE8\u91CA: ) a.createElm(vnode_RouterLink, parentElm_div),createComponent(parentElm_div)(\u5224\u65AD\u4E3A\u7EC4\u4EF6),i.hook.init\u89E6\u53D1Ctor_RouterLink\u7EC4\u4EF6\u5B9E\u4F8B\u5316\uFF0C 3. new VueComponent_RouterLink()(\u540E\u9762\u7528Watcher_Vue_RouterLink),get, \u6267\u884CrouterLink_render\u7684render\u51FD\u6570\uFF0C<em>createElement\uFF0Creturn vnode_a \u6CE8\u91CA\uFF1ArouterLink\u7684\u51FD\u6570\u5F0F\u7EC4\u4EF6\u7ED3\u6784\u5927\u6982\u5982\uFF1A const routerLink = { ... render(h) { return h(&#39;a&#39;,...) }, } \u6267\u884Cpatch_RouterLink\uFF0CcreateElm(vnode_a,parentElm_undefined ),createComponent(\u5224\u65AD\u4E3A\u975E\u7EC4\u4EF6),createChildren,children:[vnode_text</em>&quot;home\u7684link&quot;],\u5F00\u59CB\u5FAA\u73AF\u5904\u7406\u5B50\u7EC4\u4EF6dom\u63D2\u5165 createElm(vnode_text</em>&quot;home\u7684link&quot;,parentElm_a ),createComponent(\u5224\u65AD\u4E3A\u975E\u7EC4\u4EF6),createTextNode,insert(parentElm_a, vnode.elm_text, ref_undefined) \u5B50\u7EC4\u4EF6\u6216\u5B50\u6807\u7B7E\u63D2\u5165\u8FDB\u7236\u7EC4\u4EF6\u540E\uFF0C\u7EE7\u7EED\u6267\u884C\u7236\u7EA7\u672A\u5B8C\u6210\u7684\u4EE3\u7801 \u5B50\u7EC4\u4EF6\u63D2\u5165\u5B8C\u6210\uFF0C\u5F00\u59CB\u6267\u884C\u7236\u7EA7\u63D2\u5165 insert(parentElm_undefined, vnode.elm_a, ref_undefined) invokeInsertHook() \u89E6\u53D1Watcher_Vue_RouterLink\u7EC4\u4EF6\u7684mounted\u56DE\u8C03\u94A9\u5B50\u51FD\u6570 Watcher_Vue_RouterLink\u5B9E\u4F8B\u5316\u5B8C\u6210\u4E86\uFF0C\u5C06\u7EC4\u4EF6\u5B9E\u4F8B\u5316\u540E\u751F\u6210\u7684elm_a\u6302\u8F7D\u5230\u7236\u7EA7dom\u4E0A\u53BBparentElm_div insert(parentElm_div, vnode.elm_a, ref_undefined); \u5B8C\u4E86\uFF0C\u7EE7\u7EED\u4E0B\u4E00\u4E2Avnode\u7684\u63D2\u5165\u5904\u7406 b.createElm(vnode_span, parentElm_div),createChildren,children:[vnode_text</em>&quot;|&quot;],\u5F00\u59CB\u5FAA\u73AF\u5904\u7406\u5B50\u7EC4\u4EF6dom\u63D2\u5165 createElm(vnode_text</em>&quot;\uFF5C&quot;,parentElm_span ),createTextNode,insert(parentElm_span, vnode.elm_text, ref_undefined) \u5B50\u7EC4\u4EF6\u6216\u5B50\u6807\u7B7E\u63D2\u5165\u8FDB\u7236\u7EC4\u4EF6\u540E\uFF0C\u7EE7\u7EED\u6267\u884C\u7236\u7EA7\u672A\u5B8C\u6210\u7684\u4EE3\u7801 \u5B50\u7EC4\u4EF6\u63D2\u5165\u5B8C\u6210\uFF0C\u5F00\u59CB\u6267\u884C\u7236\u7EA7\u63D2\u5165 insert(parentElm_div, vnode.elm_span, ref_undefined) \u5B8C\u4E86\uFF0C\u7EE7\u7EED\u4E0B\u4E00\u4E2Avnode\u7684\u63D2\u5165\u5904\u7406 c.createElm(vnode_RouterLink, parentElm_div),...\u8DDFa\u7684\u64CD\u4F5C\u4E00\u6837\uFF0C\u6700\u540E\u5C06vnode_RouterLink\u751F\u6210\u7684dom\u63D2\u5165\u5230parentElm_div \u6B64\u65F6parentElm_div\u7684innerHTML\u5B57\u7B26\u4E32\u6709&#39;<a>xxxx</a><span>xxxx</span><a>xxxx</a>&#39; \u5B8C\u4E86\uFF0C\u7EE7\u7EED\u4E0B\u4E00\u4E2Avnode\u7684\u63D2\u5165\u5904\u7406 d.createElm(empty_vnode, parentElm_div),createComment\u521B\u5EFA\u6CE8\u91CAdom, insert(parentElm_div, vnode.elm_empty_comment, ref_undefined) \u5B50\u7EC4\u4EF6\u63D2\u5165\u5B8C\u6210\uFF0C\u5F00\u59CB\u6267\u884C\u7236\u7EA7\u63D2\u5165 insert(parentElm_undefined, vnode.elm_div, ref_undefined) invokeInsertHook() \u89E6\u53D1Watcher_Vue_App\u7EC4\u4EF6\u7684mounted\u56DE\u8C03\u94A9\u5B50\u51FD\u6570 Watcher_Vue_APP\u5B9E\u4F8B\u5316\u5B8C\u6210\u4E86\uFF0C\u5C06\u7EC4\u4EF6\u5B9E\u4F8B\u5316\u540E\u751F\u6210\u7684elm_div\u6302\u8F7D\u5230\u7236\u7EA7dom\u4E0A\u53BBparentElm_body insert(parentElm_body, vnode.elm_div, ref_undefined) \u7EC4\u4EF6\u5B9E\u4F8B\u5316\u5B8C\u6210\u540E\u7684insert</p><h5 id="\u6CE8\u610F" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u610F" aria-hidden="true">#</a> \u6CE8\u610F\uFF1A</h5><pre><code>1. \u7EC4\u4EF6render\u65F6createComponent\u4EA7\u751F\u7684vnode(\u5373\u7EC4\u4EF6vnode)\u7684children\u4E3Aundefined\uFF0Cchildren\u6302\u5728componentOptions.children\u4E0A\u4E86,\u6240\u4EE5\u5728\u7236\u7EC4\u4EF6\u8FDB\u884Cpatch\u65F6\uFF0Cupdatechildren\u7684diff\u7684\u65F6\u5019\uFF0C\u5B50\u7EC4\u4EF6\u7684children\u662Fundefined\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u8FDB\u5165\u5B50\u7EC4\u4EF6\u7684updatechildren\u7684diff\u6BD4\u5BF9\uFF0C\u76F4\u63A5\u8FDB\u5165\u4E0B\u4E00\u4E2Achild\u7684diff\u3002
2. \u90A3\u4E48\u5B50\u7EC4\u4EF6\u7684children\u5728\u4EC0\u4E48\u65F6\u5019diff\u5462\uFF1F\u5728\u5B50\u7EC4\u4EF6\u81EA\u8EAB\u8FDB\u884Cpatch\u65F6\uFF0Cupdatechildren\u7684diff\u7684\u65F6\u5019\uFF0C\u624D\u4F1A\u8FDB\u884C\u5B83\u7684\u5B50\u7EC4\u4EF6\u7684diff\uFF0C
\u4F46\u662F\u6B64\u65F6\u7684\u5B50vnode\u4E3A\u4F55\u6709children\u5462\uFF1F\u56E0\u4E3A\u5728\u5B50\u7EC4\u4EF6render\u7684\u65F6\u5019(\u8FD4\u56DE\u7684\u662F\u975E\u7EC4\u4EF6vnode)\uFF0C\u975E\u7EC4\u4EF6vnode\u4E0A\u6709children\u3002
</code></pre><h4 id="vue\u7EC4\u4EF6\u66F4\u65B0\u6E32\u67D3\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#vue\u7EC4\u4EF6\u66F4\u65B0\u6E32\u67D3\u6D41\u7A0B" aria-hidden="true">#</a> Vue\u7EC4\u4EF6\u66F4\u65B0\u6E32\u67D3\u6D41\u7A0B\uFF1F</h4><p>\u4F8B\u5B50: \u5F53\u5207\u6362hello\u513F\u5B502\u65F6Vue\u662F\u5982\u4F55\u8FD0\u8F6C\u7684\uFF1F</p><ol><li>vueRouter\u901A\u8FC7\u76D1\u542Chashchange\u6765\u6539\u53D8this._route\u7684\u503C\u6765\u901A\u77E5Vue\u53BB\u66F4\u65B0\u7EC4\u4EF6\u7684\uFF1B</li><li>\u54EA\u4E9B\u7EC4\u4EF6\u8BA2\u9605\u4E86\u8FD9\u4E2A_route\u5C5E\u6027\u5462\uFF1F\u7531\u4E8EvueRouter\u5728install\u65F6\u5168\u5C40mixin\u4E86beforeCreate\u65B9\u6CD5 <ol><li>\u6240\u4EE5new Vue\u65F6\u8BFB\u4E86this._route\uFF0C\u6240\u4EE5\u8BA2\u9605\u4E86_route\uFF1B</li><li>\u5728new RouterLink\u7684render\u65F6\u4E5F\u8BFB\u53D6\u4E86this.$route\uFF0C\u6240\u4EE5\u8BA2\u9605\u4E86_route\uFF1B</li><li>\u5728new RouterView\u7684render\u65F6\u4E5F\u8BFB\u53D6\u4E86parent.$route\uFF0C\u6240\u4EE5\u8BA2\u9605\u4E86_route\uFF1B</li></ol></li><li>\u6848\u4F8B\u4E2D\u5C31\u6709 Watcher_Vue_App\u3001 Watcher_Vue_RouterLink\u2014home\u3001 Watcher_Vue_RouterLink-hello\u3001 Watcher_Vue_Hello.vue\u3001 Watcher_Vue_RouterLink\u2014hello_child1\u3001 Watcher_Vue_RouterLink-hello_child2\u3001</li><li>\u5F53this._route\u6539\u53D8\u4F1A\u901A\u77E5\u4E0A\u9762\u6240\u6709\u7684wathcer\u53BB\u66F4\u65B0\u89C6\u56FE</li><li>Watcher_Vue_App\u66F4\u65B0App\uFF0C\u6267\u884Cwatcher.run\u89E6\u53D1updateComponent\uFF0C\u91CD\u65B0\u7EC4\u4EF6app-render\uFF0C\u8FD4\u56DE\u975E\u7EC4\u4EF6vnode_div\uFF0Cpatch\u65B0\u65E7\u975E\u7EC4\u4EF6vnode_div\uFF0C\u975E\u7EC4\u4EF6vnode_div\u6709children:[vnode_RouterLink,vnode_span,vnode_RouterLink,vnode_hello]\uFF0CupdateChildren\uFF0C\u5F00\u59CBdiff\u6BD4\u5BF9\u65B0\u65E7children\uFF0Cvnode_RouterLink\\vnode_RouterLink\\vnode_hello\u90FD\u662F\u7EC4\u4EF6vnode\uFF0C\u6CA1\u6709child\u4E0D\u7EE7\u7EEDupdateChildren\u7684diff\u6BD4\u5BF9,vnode_span\u6709children:[vnode_|],updateChildren\uFF0C\u5F00\u59CBdiff\u6BD4\u5BF9\u65B0\u65E7vnode_span\u7684children\uFF0C\u66F4\u65B0\u65E7vnode_|\u7684\u771F\u5B9Edom\uFF0C\u5B8C\u6210vnode_div\u7684patch\uFF1B</li><li>Watcher_Vue_RouterLink\u2014home\u3001Watcher_Vue_RouterLink-hello\u7C7B\u4F3C\u4E0A\u9762\u7684\u6D41\u7A0B\uFF1B</li><li>Watcher_Vue_Hello.vue\u66F4\u65B0Hello.vue\uFF0C\u6267\u884Cwatcher.run\u89E6\u53D1updateComponent\uFF0C\u91CD\u65B0\u7EC4\u4EF6hello-render\uFF0C\u8FD4\u56DE\u975E\u7EC4\u4EF6vnode_hello\uFF0Cpatch\u65B0\u65E7\u975E\u7EC4\u4EF6vnode_hello\uFF0C\u975E\u7EC4\u4EF6vnode_hello\u6709children:[vnode_div,vnode_RouterLink,vnode_|,vnode_RouterLink,vnode_hello_child1]\uFF0CupdateChildren\uFF0C\u5F00\u59CBdiff\u6BD4\u5BF9\u65B0\u65E7children\uFF0C\u524D\u97624\u4E2A\u7C7B\u4F3C5\u7684\u540E\u9762\u6D41\u7A0B\uFF0Cvnode_hello_child1\u4E0E\u65B0\u7684vnode_hello_child2\u6BD4\u5BF9\uFF0C\u53D1\u73B0\u6CA1\u6709\u4E45\u7684isUndef(idxInOld)\u4E00\u6837\u7684Vnode\uFF0CcreateElm\u521B\u5EFA\u65B0\u7684dom(\u4F20\u53C2parenr_div_hello)\uFF0Cvnode_hello_child2\u4E3A\u7EC4\u4EF6vnode\uFF0CcreateComponent(\u5224\u65AD\u4E3A\u7EC4\u4EF6)\uFF0C\u5B9E\u4F8B\u5316\u7EC4\u4EF6\uFF0C\u5B9E\u4F8B\u5B8C\u6210\u63D2\u5165\u7236\u7EA7dom(parenr_div_hello)\uFF0C\u6700\u540E\u65B0\u65E7\u6307\u9488\u5206\u522B\u6BD4\u5BF9\uFF0C\u5F53\u65E7\u6307\u9488oldStartIdx &gt; oldEndIdx\u4E3Afalse\uFF0CnewStartIdx &gt; newEndIdx\u4E3Atrue\uFF0C\u8BF4\u660E\u65E7\u7684dom\u6709\u591A\u4F59\u7684\uFF0C\u5220\u9664\u6389\u591A\u4F59\u7684\uFF1BremoveVnodes(oldCh, oldStartIdx, oldEndIdx);</li><li>\u6700\u540E\u5B8C\u6210Watcher_Vue_Hello.vue\u66F4\u65B0</li><li>\u7EE7\u7EED\u540E\u9762\u6CA1\u5B8C\u6210\u7684wathcer\u7684\u66F4\u65B0\u3002</li></ol><h4 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h4><ol><li>\u521D\u6B21\u6E32\u67D3\uFF1A 1. vue \u5B9E\u4F8B\u5316\uFF0C\u505A\u4E86options\u5408\u5E76\uFF0C\u6570\u636E\u52AB\u6301\uFF0C\u76D1\u542C\u6570\u636E\u53D8\u5316\uFF1B 2. \u5F00\u59CB\u6302\u8F7D\uFF0C\u542F\u52A8watcher\u76D1\u542C\uFF0C\u6267\u884Crender\u751F\u6210vnode\uFF0C\u6839\u636Evnode\u751F\u6210\u771F\u5B9Edom\uFF0C\u6302\u8F7D\u5230\u9875\u9762\u3002</li><li>\u66F4\u65B0\uFF1A 1. \u6570\u636E\u53D8\u5316\uFF0C\u901A\u77E5\u5BF9\u5E94\u7684watcher\u53BBupdate\u66F4\u65B0\u89C6\u56FE\uFF1B 2. \u91CD\u65B0\u6267\u884Crender\u751F\u6210vnode\uFF0Cpatch\u6BD4\u5BF9\u65B0\u65E7vnode\uFF0Cdiff\u5176\u5B50\u7EC4\u4EF6\u4EEC\uFF0C\u66F4\u65B0\u771F\u5B9Edom\uFF1B</li><li>\u6CE8\u610F\u7684\u662F\uFF1A \u5728\u66F4\u65B0\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u7236\u7EA7\u7EC4\u4EF6\u4E0B\u6709\u591A\u4E2A\u5B50\u7EC4\u4EF6(vnodes)\uFF0C\u800C\u5B50\u7EC4\u4EF6\u4E2D\u5982\u679C\u662F\u7EC4\u4EF6vnode\uFF0C\u90A3\u4E48\u6BD4\u5BF9\u8FC7\u7A0B\u4E2D\u53EA\u6BD4\u5BF9\u5F53\u524D\u65B0\u65E7\u7EC4\u4EF6vnode\uFF0C\u800C\u4E0D\u7EE7\u7EED\u6DF1\u5165\u6BD4\u5BF9\u5176\u5B50\u7EC4\u4EF6\uFF0C\u5982\u679C\u4E0D\u662F\u7EC4\u4EF6vnode,\u662F\u666E\u901A\u8282\u70B9vnode\uFF0C\u90A3\u4E48\u4F1A\u6DF1\u5165diff\u6BD4\u5BF9\u5176\u5B50\u7EC4\u4EF6\uFF0Cdiff\u7684\u8FC7\u7A0B\u4F1A\u64CD\u4F5C\u65E7\u7684\u771F\u5B9Edom\u8FDB\u800C\u76F4\u63A5\u66F4\u65B0\u9875\u9762\uFF1B \u90A3\u4E48\u7EC4\u4EF6vnode\u4F55\u65F6\u6DF1\u5165\u6BD4\u5BF9\u5176\u5B50\u7EC4\u4EF6\u5462\uFF1F\u5982\u679C\u8FD9\u4E2A\u7EC4\u4EF6vnode\u6709\u8BA2\u9605\u5BF9\u5E94\u7684\u6570\u636E\uFF0C\u90A3\u4E48\u6570\u636E\u66F4\u65B0\uFF0C\u4E5F\u4F1A\u89E6\u53D1\u8D77watcher\uFF0C\u8FDB\u800C\u91CD\u65B0render\u5176\u751F\u6210vnode\uFF0C\u53BB\u6BD4\u5BF9\u5B83\u7684\u65B0\u65E7vnode\uFF0Cdiff\u5176\u5B50\u7EC4\u4EF6\u4EEC\uFF0C\u66F4\u65B0\u771F\u5B9Edom\uFF1B</li></ol><h4 id="\u5B8C" tabindex="-1"><a class="header-anchor" href="#\u5B8C" aria-hidden="true">#</a> \u5B8C</h4>`,22),i=[d];function a(l,u){return t(),n("div",null,i)}var v=e(o,[["render",a],["__file","Vue\u8BF4\u660E-\u6E32\u67D3\u6D41\u7A0B.html.vue"]]);export{v as default};
